<form
  class="m-auto text-slate-700"
  [formGroup]="contactForm"
  (ngSubmit)="onSubmit()"
>
  <div>
    <div
      *ngIf="contactForm.errors?.isDuplicatedContact"
      class="bg-red-500 border-l-4 text-white p-4"
      role="alert"
    >
      <p class="font-bold">Warning</p>
      <p>Name is already registered. Check the data again.</p>
    </div>
    <h1 class="text-xl text-center font-semibold">
      {{ editMode == true ? "Update Contact" : "New Contact " }}
    </h1>
  </div>
  <section class="flex flex-row w-full pb-4">
    <div class="flex flex-col pr-4">
      <label for="firstname" class="text-bold">First Name</label>
      <input
        class="border-b-2 border-slate-200 w-full hover:border-sky-200 focus:border-sky-400"
        type="text"
        id="firstname"
        [formControl]="contactForm.get('firstName') | asFormControl"
      />
      <small
        *ngIf="
          contactForm.get('firstName')?.errors?.required &&
          contactForm.get('firstName')?.dirty
        "
        class="error-red"
      >
        First name is required.
      </small>
      <small
        *ngIf="
          contactForm.get('firstName')?.errors?.pattern &&
          contactForm.get('firstName')?.dirty
        "
        class="error-red"
      >
        First name cannot have a space.
      </small>
    </div>
    <div class="flex flex-col">
      <label for="lastname" class="text-bold">Last Name</label>
      <input
        class="border-b-2 border-slate-200 w-full hover:border-sky-200 focus:border-sky-400"
        type="text"
        id="lastname"
        [formControl]="contactForm.get('lastName') | asFormControl"
      />
      <small
        *ngIf="
          contactForm.get('lastName')?.errors?.required &&
          contactForm.get('lastName')?.dirty
        "
        class="error-red"
      >
        Last name is required.
      </small>
      <small
        *ngIf="
          contactForm.get('lastName')?.errors?.pattern &&
          contactForm.get('lastName')?.dirty
        "
        class="error-red"
      >
        Last name cannot have a space.
      </small>
    </div>
  </section>
  <section class="flex flex-row w-full pb-4">
    <div class="flex flex-col pr-4">
      <label for="title" class="text-bold">Title</label>
      <input
        class="border-b-2 border-slate-200 w-full hover:border-sky-200 focus:border-sky-400"
        type="text"
        id="title"
        [formControl]="contactForm.get('title') | asFormControl"
      />
    </div>
    <div class="flex flex-col">
      <label for="company" class="text-bold">Company</label>
      <input
        class="border-b-2 border-slate-200 w-full hover:border-sky-200 focus:border-sky-400"
        type="text"
        id="company"
        [formControl]="contactForm.get('company') | asFormControl"
      />
    </div>
  </section>
  <section class="flex flex-row w-full pb-4">
    <div class="flex flex-col">
      <div
        *ngFor="let group of contactForm.get('addresses') | asFormGroupArray"
      >
        <label for="address" class="text-bold">Street Address</label>
        <input
          class="border-b-2 border-slate-200 w-full hover:border-sky-200 focus:border-sky-400"
          type="text"
          id="address"
          [formControl]="group.get('streetAddress') | asFormControl"
        />

        <div class="flex flex-row space-x-4 justify-between">
          <div class="flex flex-col w-3/6">
            <label for="address" class="text-bold">City</label>
            <input
              class="border-b-2 border-slate-200 w-full hover:border-sky-200 focus:border-sky-400"
              type="text"
              id="city"
              [formControl]="group.get('city') | asFormControl"
            />
          </div>
          <div class="flex flex-col w-1/6">
            <div class="pt-2 pb-1">State</div>
            <select
              class="border-b-2 border-slate-200 w-full hover:border-sky-200 focus:border-sky-400"
              [formControl]="group.get('state') | asFormControl"
              [value]="states"
            >
              <option value="undefined"></option>
              <option *ngFor="let state of states">
                {{ state }}
              </option>
            </select>
          </div>
          <div class="flex flex-col w-1/6">
            <div class="pt-2 pb-1">Zipcode</div>
            <input
              class="border-b-2 border-slate-200 w-full hover:border-sky-200 focus:border-sky-400 lining-nums"
              type="text"
              id="zipcode"
              [formControl]="group.get('zipcode') | asFormControl"
            />
            <small
              *ngIf="
                (group.get('zipcode')?.errors?.maxlength ||
                  group.get('zipcode')?.errors?.required ||
                  group.get('zipcode')?.errors?.pattern) &&
                group.get('zipcode')?.dirty
              "
              class="error-red"
            >
              Must be 5-digit numbers (ex 12345)
            </small>
          </div>
        </div>
      </div>
      <div>
        <button type="button" (click)="addAddress()">+ Add Address</button>
      </div>
    </div>
  </section>

  <section class="flex flex-row w-full pb-4">
    <section class="flex flex-col w-1/2">
      <div class="subHeader">
        Email <button type="button" (click)="addEmailAddress()">+</button>
      </div>
      <div
        *ngFor="
          let group of contactForm.get('emailAddresses') | asFormGroupArray;
          first as isFirst;
          let i = index
        "
        class="py-1"
      >
        <p>
          <input
            class="border-b-2 border-slate-200 w-2/3 hover:border-sky-200 focus:border-sky-400"
            type="text"
            id="email"
            [formControl]="group.get('emailAddress') | asFormControl"
          />

          <span
            ><fa-icon
              [icon]="faTrashCan"
              class="trash-icon pl-3"
              (click)="deleteEmail(i)"
              *ngIf="!isFirst"
            ></fa-icon
          ></span>
        </p>
        <small
          *ngIf="
            group.get('emailAddress')?.errors?.email &&
            group.get('emailAddress')?.dirty
          "
          class="error-red"
        >
          Enter a valid email address
        </small>
      </div>
    </section>

    <section class="flex flex-col pl-4">
      <div class="subHeader">
        Phone
        <button type="button" (click)="addPhoneNumber()">+</button>
      </div>
      <div
        *ngFor="
          let group of contactForm.get('phoneNumbers') | asFormGroupArray;
          first as isFirst;
          let i = index
        "
        class="py-1"
      >
        <input
          class="border-b-2 border-slate-200 w-full hover:border-sky-200 focus:border-sky-400 lining-nums"
          type="tel"
          id="phone"
          [formControl]="group.get('phoneNumber') | asFormControl"
        />
        <fa-icon
          [icon]="faTrashCan"
          class="trash-icon pl-3"
          (click)="deletePhoneNumber(i)"
          *ngIf="!isFirst"
        ></fa-icon>
        <div>
          <small
            *ngIf="
              group.get('phoneNumber')?.errors?.pattern &&
              group.get('phoneNumber')?.dirty
            "
            class="error-red"
          >
            Numeric Value only.
          </small>
          <div>
            <small
              *ngIf="
                group.get('phoneNumber')?.errors?.required &&
                group.get('phoneNumber')?.dirty
              "
              class="error-red"
            >
              Phone number is required
            </small>
          </div>
        </div>
      </div>
    </section>
  </section>
  <div class="flex flex-row justify-between pt-10">
    <button
      type="submit"
      class="w-20 font-semibold rounded-lg bg-emerald-500 text-zinc-100 p-2"
    >
      {{ editMode == true ? "Update" : "Submit" }}
    </button>
    <button
      class="w-20 font-semibold rounded-lg bg-rose-500 p-2 text-zinc-100"
      type="reset"
    >
      Clear
    </button>
  </div>
</form>
